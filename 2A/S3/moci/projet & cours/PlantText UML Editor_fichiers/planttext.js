var googleResponse,plantUserId="None",sidebar_portrait_w=500,sidebar_portrait_h_mod=180,sidebar_landscape_w_mod=45,sidebar_landscape_h_mod=2,sidebar_offset={top:101,left:13},diagram_offset={top:101,left:535},warn_about_samples=!0,editor=ace.edit("editor"),textarea=$('textarea[name="description"]').hide();function toggleNewspop(){"undefined"!=typeof Storage&&(document.getElementById("newpopstop").checked?localStorage.setItem("planttext_message","4"):localStorage.setItem("planttext_message","3"))}function saveFromButton(){$("#loader").show(),"undefined"!=typeof Storage&&(localStorage.setItem("planttext_layout",$("input[name='layout']:checked").val()),localStorage.setItem("planttext_fontsize",document.getElementById("fontsize").value),localStorage.setItem("planttext_indentguide",document.getElementById("indentguide").checked),localStorage.setItem("planttext_invisibles",document.getElementById("invisibles").checked),localStorage.setItem("planttext_keybinding",document.getElementById("keybinding").value),localStorage.setItem("planttext_plantumlserver",""==document.getElementById("plantumlserver").value?"default":document.getElementById("plantumlserver").value),localStorage.setItem("planttext_theme",document.getElementById("theme").value)),$("#loader").hide(),$.ajax({type:"PUT",url:"api/counters/",headers:{"PlantText-Id":googleResponse.id},timeout:5e3,data:{type:"user_save"},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}}),$("#fademessage").css("color","black").css("background-color","white").html("Your PlantUML and settings have been saved to the PlantText server. You can load them now from any computer.").fadeIn(1).fadeOut(5e3),$("#setting").dialog("close")}function toggleVisibles(){0==editor.getShowInvisibles()?editor.setShowInvisibles(!0):editor.setShowInvisibles(!1)}function toggleIndentGuide(){0==editor.getDisplayIndentGuides()?editor.setDisplayIndentGuides(!0):editor.setDisplayIndentGuides(!1)}function ptq(e){var t,a,o,n=e.replace(/;/g,"&").split("&");for(e={},t=0;t<n.length;t++)o=n[t].split("=",2),e[a=unescape(o[0])]||(e[a]=[]),1<o.length?e[a][e[a].length]=unescape(o[1]):e[a][e[a].length]=!0;return e}function param(){return ptq(location.search.substring(1).replace(/\+/g," "))}function entify(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/>/g,"&gt;")}function refreshFromButton(){var e=document.getElementById("description").value;if("undefined"!=typeof Storage){var t=localStorage.getItem("planttext_default");null!=t&&""!=t&&localStorage.setItem(t,e)}compress(e),$("#fademessage").css("color","black").css("background-color","white").html("The diagram is refreshing and your PlantUML has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3);var a="";a=googleResponse?googleResponse.id:"anonymous"+$.datepicker.formatDate("yymmdd",new Date),$.ajax({type:"PUT",url:"api/counters/",headers:{"PlantText-Id":a},timeout:5e3,data:{type:"user_refresh"},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}})}function defaultFromButton(){document.getElementById("plantumlserver").value="",$("#fademessage").css("color","black").css("background-color","white").html("The PlantUML server is now set to ... '"+document.getElementById("plantumlserver").value+"'.").fadeIn(1).fadeOut(5e3)}function urlFromPlantUML(){var e=document.getElementById("scriptingimagetype").value,t=document.getElementById("description").value;$("#loader").show(),$.ajax({type:"POST",url:"api/scripting",timeout:5e3,data:{type:""+e,plantuml:""+t},success:function(e){document.getElementById("scriptingoutput").value=e;var t="";t=googleResponse?googleResponse.id:"anonymous"+$.datepicker.formatDate("yymmdd",new Date),$.ajax({type:"PUT",url:"api/counters/",headers:{"PlantText-Id":t},timeout:5e3,data:{type:"scripting"}})},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}}),$("#loader").hide(),$("#fademessage").css("color","black").css("background-color","white").html("Converting PlantUML to code stubs.").fadeIn(1).fadeOut(5e3)}function codeFromButton(){var e=document.getElementById("language").value,t=document.getElementById("description").value;$("#loader").show(),$.ajax({type:"POST",url:"api/code",timeout:5e3,data:{language:""+e,plantuml:""+t},success:function(e){document.getElementById("codeoutput").value=e;var t="";t=googleResponse?googleResponse.id:"anonymous"+$.datepicker.formatDate("yymmdd",new Date),$.ajax({type:"PUT",url:"api/counters/",headers:{"PlantText-Id":t},timeout:5e3,data:{type:"code_convert"}})},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}}),$("#loader").hide(),$("#fademessage").css("color","black").css("background-color","white").html("Converting PlantUML to code stubs.").fadeIn(1).fadeOut(5e3)}function refreshFromSamples(e){editor.getSession().setValue(e),compress(document.getElementById("description").value),resizeEditor()}function resizeBrowser(){$("#layout-landscape").attr("checked")?landscape():portrait(),$("#sidebar").height($(window).height()-sidebar_portrait_h_mod),resizeEditor()}function resizeEditor(){$("#editor").width($("#sidebar").width()-10),$("#editor").height($("#sidebar").height()-45),editor.resize()}function openHelp(){$("#help").dialog("open")}function openSettings(){$("#setting").dialog("open")}function openCode(){$("#code").dialog("open")}function openScripting(){$("#scripting").dialog("open")}function openFiles(){$("#files").dialog("open")}function openNewspop(){$("#newspop").dialog("open")}function fileNameOutput(){var e=localStorage.getItem("planttext_default");$("#file-name-output").text(e.substring(18))}function openFileMenuNew(){$("#file-menu-new").dialog("open")}function submitFileMenuNew(){var e="",t=$("#file-menu-new-name").val().trim(),a=!1;for(i=0;i<window.localStorage.length;i++){var o=window.localStorage.key(i);if("planttext_diagram:"===o.substring(0,18)&&o.substring(18).trim()==t.trim()){a=!0;break}}if(a)e="This file name is already in use. Please try another name.",$("#file-menu-new-message").text(e);else if(""==t.trim()||40<=t.length)e="Please enter a name that is fewer than 40 characters.",$("#file-menu-new-message").text(e);else if(null!=t){var n="@startuml\r\rtitle Empty Diagram\r\r@enduml",l="planttext_diagram:"+t;localStorage.setItem("planttext_default",l),localStorage.setItem(l,n),fileNameOutput(l),refreshFromSamples(n),$("#file-menu-new").dialog("close")}}function submitFileMenuNewCancel(){$("#file-menu-new").dialog("close")}function openFileMenuOpen(){$("#file-menu-open").dialog("open")}function submitFileMenuOpen(){var e="",t=$("#file-menu-open-list").val(),a=localStorage.getItem("planttext_default");if(null==t)e="Please select a file to open or close this window.",$("#file-menu-open-message").text(e);else if(a==t)e="You have selected the same file that is currently open.",$("#file-menu-open-message").text(e);else{var o=localStorage.getItem(t);localStorage.setItem("planttext_default",t),localStorage.setItem(t,o),fileNameOutput(t),refreshFromSamples(o),$("#file-menu-open").dialog("close")}}function submitFileMenuOpenLoad(){for($("#file-menu-open-list").html(""),i=0;i<window.localStorage.length;i++){var e=localStorage.key(i);if("planttext_diagram:"===e.substring(0,18)){localStorage.getItem(e);$("#file-menu-open-list").append('<option value="'+e+'">'+e.substring(18,e.length)+"</option>")}}}function submitFileMenuOpenCancel(){$("#file-menu-open").dialog("close")}function submitFileMenuSave(){if(""==(t=localStorage.getItem("planttext_default")))alert("No file is currently loaded. Please use Save As to create a new file.");else{var e=$("#description").val();if("undefined"!=typeof Storage){var t=localStorage.getItem("planttext_default");localStorage.setItem(t,e),$("#fademessage").css("color","black").css("background-color","white").html("The diagram has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3)}else alert("It appears you do not have a local storage capable browser or configuration. Please reolve before trying to use this application")}}function openFileMenuSaveas(){$("#file-menu-saveas").dialog("open")}function submitFileMenuSaveas(){var e="",t=$("#file-menu-saveas-name").val().trim(),a=!1;for(i=0;i<window.localStorage.length;i++){var o=window.localStorage.key(i);if("planttext_diagram:"===o.substring(0,18)&&o.substring(18).trim()==t.trim()){a=!0;break}}if(a)e="This file name is already in use. Please try another name.",$("#file-menu-saveas-message").text(e);else if(""==t.trim()||40<=t.length)e="Please enter a name that is fewer than 40 characters.",$("#file-menu-saveas-message").text(e);else if(null!=t){var n=document.getElementById("description").value,l="planttext_diagram:"+t;localStorage.setItem("planttext_default",l),localStorage.setItem(l,n),fileNameOutput(l),refreshFromSamples(n),$("#file-menu-saveas").dialog("close")}}function submitFileMenuSaveasCancel(){$("#file-menu-saveas").dialog("close")}function submitFileMenuDelete(){if("undefined"!=typeof Storage){var e=localStorage.getItem("planttext_default");""==e?alert("No file is currently loaded. Please open the file you wish to delete."):(localStorage.removeItem(e),localStorage.setItem("planttext_default",""),refreshFromSamples("@startuml\r\rtitle Empty Diagram\r\r@enduml"),$("#file-name-output").text(""))}}function openFileMenu(){document.getElementById("file-menu-list").classList.toggle("show")}function unDock(){var e=$(window).width()-($("#sidebar").width()+50);$("#sidebar").draggable(),$("#sidebar").css({top:10}),$("#sidebar").css({left:+e}),$("#content").offset(sidebar_offset),resizeEditor(),$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in drag mode. You can move it around to any position on the screen.").fadeIn(1).fadeOut(5e3)}function doDock(){$("#sidebar").draggable("destroy"),$("#sidebar").width(sidebar_portrait_w),$("#sidebar").height($(window).height()-sidebar_portrait_h_mod),$("#sidebar").offset(sidebar_offset),$("#sidebar").css({float:"left"}),resizeEditor(),$("#content").css({float:"left"}),$("#content").offset(diagram_offset),$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in dock mode. It will always be docked to the upper left and the diagram will to the right or below it.").fadeIn(1).fadeOut(5e3)}function portrait(){$("#sidebar").height($(window).height()-sidebar_portrait_h_mod),$("#sidebar").width(sidebar_portrait_w),resizeEditor()}function landscape(){$("#sidebar").height($(window).height()/sidebar_landscape_h_mod),$("#sidebar").width($(window).width()-sidebar_landscape_w_mod),resizeEditor()}function importUML(){var e=document.getElementById("fileInput").files[0];if(e.type.match(/text.*/)){var t=new FileReader;t.onload=function(e){editor.getSession().setValue(t.result),compress(document.getElementById("description").value)},t.readAsText(e),resizeEditor()}else alert("File not supported!");return!1}editor.getSession().setValue(textarea.val()),editor.getSession().on("change",function(){textarea.val(editor.getSession().getValue())}),document.getElementById("theme").onchange=function(){var e=this.options[this.selectedIndex].value;editor.setTheme("ace/theme/"+e)},document.getElementById("fontsize").onchange=function(){var e=this.options[this.selectedIndex].value;editor.setFontSize(e+"px"),editor.resize()},document.getElementById("keybinding").onchange=function(){var e=this.options[this.selectedIndex].value;editor.setKeyboardHandler("ace/keyboard/"+e)},document.getElementById("samples").onchange=function(){var e=this.options[this.selectedIndex].value;if("default"!=e){var t=!0;warn_about_samples&&(t=confirm('This will replace the PlantUML you have in your editor window. Press "Ok" to coninue or "Cancel" to abort.',"Samples"),warn_about_samples=!1),t&&($("#loader").show(),$.ajax({type:"GET",url:"api/samples/"+e,success:function(e){refreshFromSamples(e.content),$("#loader").hide();var t="";t=googleResponse?googleResponse.id:"anonymous"+$.datepicker.formatDate("yymmdd",new Date),$.ajax({type:"PUT",url:"api/counters/",headers:{"PlantText-Id":t},timeout:5e3,data:{type:"sample_load"},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}})},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}}))}},window.onclick=function(e){if(!e.target.matches("#file-menu-button")){var t,a=document.getElementsByClassName("file-menu-dropdown-content");for(t=0;t<a.length;t++){var o=a[t];o.classList.contains("show")&&o.classList.remove("show")}}};var Download={click:function(e){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",!0,!1,self,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)},encode:function(e){return"data:application/octet-stream;base64,"+btoa(e)},link:function(e,t){var a=document.createElement("a");return a.download=t||self.location.pathname.slice(self.location.pathname.lastIndexOf("/")+1),a.href=e||self.location.href,a}};function exportUML(){return Download.save(editor.getSession().getValue(),"plantuml_export.txt"),!1}function afterAuthentication(){if(googleResponse){if($("#loader").show(),"undefined"!=typeof Storage){$("#savebutton").removeAttr("disabled"),$("#defaultserver").removeAttr("disabled"),$("#plantumlserver").removeAttr("disabled"),$("#file-menu-button").removeAttr("disabled");var e=localStorage.getItem("planttext_layout"),t=localStorage.getItem("planttext_theme"),a=localStorage.getItem("planttext_keybinding"),o=localStorage.getItem("planttext_fontsize"),n="true"==localStorage.getItem("planttext_invisibles"),l="true"==localStorage.getItem("planttext_indentguide"),i=localStorage.getItem("planttext_plantumlserver");document.getElementById("plantumlserver").value="default"==i?"":i,"landscape"==e?($("#layout-landscape").attr("checked",!0),landscape()):($("#layout-portrait").attr("checked",!0),portrait()),$("#theme option[value='"+t+"']").attr("selected",!0),$("#keybinding option[value='"+a+"']").attr("selected",!0),$("#fontsize option[value='"+o+"']").attr("selected",!0),n?$("#invisibles").attr("checked"):$("#invisibles").removeAttr("checked"),l?$("#indentguide").attr("checked"):$("#indentguide").removeAttr("checked"),editor.getSession().setMode("ace/mode/text"),editor.setTheme("ace/theme/"+t),editor.setFontSize(o+"px"),editor.setKeyboardHandler("ace/keyboard/"+a),editor.setShowInvisibles(n),editor.setDisplayIndentGuides(l)}$.ajax({type:"POST",url:"api/users",timeout:5e3,data:{gid:googleResponse.id,first_name:googleResponse.name.givenName,last_name:googleResponse.name.familyName,display_name:googleResponse.displayName,email:googleResponse.emails[0].value,url:googleResponse.url},success:function(e){null==localStorage.getItem("planttext_diagram:My Saved Diagram")&&""!=e.diagram.trim()&&localStorage.setItem("planttext_diagram:My Saved Diagram",e.diagram)},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}})}else editor.getSession().setMode("ace/mode/text"),editor.setTheme("ace/theme/textmate"),editor.setFontSize("12px"),editor.setKeyboardHandler("ace/keyboard/ace"),editor.setShowInvisibles(!0),editor.setDisplayIndentGuides(!0),$("#savebutton").attr("disabled","disabled"),$("#defaultserver").attr("disabled","disabled"),$("#plantumlserver").attr("disabled","disabled"),$("#file-menu-button").attr("disabled","disabled");$("#loader").hide();var r="";r=googleResponse?googleResponse.id:"anonymous"+$.datepicker.formatDate("yymmdd",new Date),$.ajax({type:"PUT",url:"api/counters/",headers:{"PlantText-Id":r},timeout:5e3,data:{type:"authentication"},error:function(e,t,a){console.log("Status: "+t+" -- Error: "+a),$("#loader").hide()}})}Download.save=function(e,t){this.click(this.link(this.encode(e),t))},$(window).resize(resizeBrowser),resizeBrowser(),$(document).keydown(function(e){13==e.keyCode&&e.altKey&&$("#refreshbutton").click()}),$(document).ready(function(){$("#file-menu-new").dialog({title:"New",width:350,autoOpen:!1,modal:!0,resizable:!1,draggable:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500},open:function(){},close:function(){$("#file-menu-new-name").val(""),$("#file-menu-new-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#file-menu-open").dialog({title:"Open",autoOpen:!1,modal:!0,resizable:!0,draggable:!1,width:500,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500},open:function(){submitFileMenuOpenLoad()},close:function(){$("file-menu-open-list").html(""),$("#file-menu-open-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#file-menu-saveas").dialog({title:"Save As...",autoOpen:!1,modal:!0,resizable:!1,draggable:!1,width:300,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500},open:function(){},close:function(){$("#file-menu-saveas-name").val(""),$("#file-menu-saveas-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#sidebar").resizable({resize:function(e,t){resizeEditor()},minHeight:350,minWidth:420}),$("#help").dialog({title:"Help",width:600,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#setting").dialog({title:"Settings",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#code").dialog({title:"Code",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#scripting").dialog({title:"Scripting",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#files").dialog({title:"Import / Export",width:500,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff"),$("#newspop").dialog({title:"News",width:500,autoOpen:!1,modal:!0,resizable:!1,draggable:!1,show:{effect:"blind",duration:500},hide:{effect:"blind",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");var e=!1,t="";for(k in q=param(),q)"text"==entify(k)&&(e=!0,t=entify(q[k][0]));var a=localStorage.getItem("plantuml_diagram"),o=localStorage.getItem("planttext_default");if(null===a&&null===o?(localStorage.setItem("planttext_default","planttext_diagram:Default Diagram"),localStorage.setItem("planttext_diagram:Default Diagram","@startuml\r\rBob -> Alice: Hello!\r\r@enduml")):null!=a&&null===o&&(localStorage.setItem("planttext_default","planttext_diagram:Default Diagram"),localStorage.setItem("planttext_diagram:Default Diagram",a),localStorage.removeItem("plantuml_diagram")),"undefined"!=typeof Storage){var n=localStorage.getItem("planttext_message");null!=n&&(localStorage.setItem("planttext_message",n),localStorage.removeItem("plantuml_diagram")),null==localStorage.getItem("planttext_theme")&&(localStorage.setItem("planttext_layout","portrait"),localStorage.setItem("planttext_fontsize","12"),localStorage.setItem("planttext_indentguide",!0),localStorage.setItem("planttext_invisibles",!0),localStorage.setItem("planttext_keybinding","ace"),localStorage.setItem("planttext_plantumlserver","default"),localStorage.setItem("planttext_theme","textmate"))}if(e)refreshFromSamples(decode64(t));else if("undefined"!=typeof Storage){if(""==(o=localStorage.getItem("planttext_default")))editor.getSession().setValue("@startuml\r\rtitle Empty Diagram\r\r@enduml");else if(null!=o){var l=localStorage.getItem(o);fileNameOutput(o),editor.getSession().setValue(l)}}else alert("It appears you do not have a local storage capable browser or configuration. Please resolve before trying to use this application");if("undefined"!=typeof Storage){var i=localStorage.getItem("planttext_message");null!==i&&"6"==i||openNewspop()}compress(document.getElementById("description").value)});
