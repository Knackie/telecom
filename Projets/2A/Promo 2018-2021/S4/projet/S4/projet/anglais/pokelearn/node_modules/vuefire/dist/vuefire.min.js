/*!
  * vuefire v2.2.0
  * (c) 2019 Eduardo San Martin Morote
  * @license MIT
  */
var Vuefire=function(e){"use strict";function t(e,t,n){var r=(""+t).split("."),i=r.pop(),o=r.reduce(function(e,t){return e[t]},e);return Array.isArray(o)?o.splice(Number(i),1,n):o[i]=n}function n(e){return e&&"object"==typeof e}function r(e,t){for(var n=0;n<e.length;n++)if(e[n][".key"]===t)return n;return-1}var i={reset:!0,serialize:function(e){var t=e.val(),r=n(t)?t:Object.defineProperty({},".value",{value:t});return Object.defineProperty(r,".key",{value:e.key}),r},wait:!1};function o(e,t,r,i){void 0===t&&(t={}),void 0===r&&(r=""),void 0===i&&(i=[{},{}]),t=t||{};var s=i[0],a=i[1],f=Object.getOwnPropertyDescriptor(e,"id");f&&!f.enumerable&&Object.defineProperty(s,"id",f);var c=function(i){var f,c=e[i];if((f=c)&&f.onSnapshot)s[i]=t[i]||c.path,a[r+i]=c;else if(Array.isArray(c)){s[i]=Array(c.length);var u=(t[i]||[]).filter(function(e){return-1!==c.indexOf(e)});o(c,u,r+i+".",[s[i],a])}else null==c||c instanceof Date||function(e){return e.toDate}(c)||c.longitude&&c.latitude?s[i]=c:n(c)?(s[i]={},o(c,t[i],r+i+".",[s[i],a])):s[i]=c};for(var u in e)c(u);return i}var s={maxRefDepth:2,reset:!0,serialize:function(e){return Object.defineProperty(e.data(),"id",{value:e.id})},wait:!1};function a(e){for(var t in e)e[t].unsub()}function f(e,t){var n=e.snapshot,r=e.target,i=e.path,s=e.subs,a=e.ops,f=e.depth,c=e.resolve,l=o(n,function(e,t){return t.split(".").reduce(function(e,t){return e[t]},e)}(r,i)),d=l[0],v=l[1];a.set(r,i,d),u({subs:s,refs:v,target:r,path:i,ops:a,depth:f,resolve:c},t)}function c(e,t){var n=e.ref,r=e.target,i=e.path,o=e.depth,s=e.resolve,c=e.ops,u=Object.create(null),l=n.onSnapshot(function(e){e.exists?f({snapshot:t.serialize(e),target:r,path:i,ops:c,subs:u,depth:o,resolve:s},t):(c.set(r,i,null),s(i))});return function(){l(),a(u)}}function u(e,t){var n=e.subs,r=e.refs,i=e.target,o=e.path,s=e.depth,a=e.ops,f=e.resolve,u=Object.keys(r);if(Object.keys(n).filter(function(e){return u.indexOf(e)<0}).forEach(function(e){n[e].unsub(),delete n[e]}),!u.length||++s>t.maxRefDepth)return f(o);var l=0,d=u.length,v=Object.create(null);function p(e){e in v&&++l>=d&&f(o)}u.forEach(function(e){var f=n[e],u=r[e],l=o+"."+e;if(v[l]=!0,f){if(f.path===u.path)return;f.unsub()}n[e]={unsub:c({ref:u,target:i,path:l,depth:s,ops:a,resolve:p.bind(null,l)},t),path:u.path}})}var l={set:function(e,n,r){return t(e,n,r)},add:function(e,t,n){return e.splice(t,0,n)},remove:function(e,t){return e.splice(t,1)}};function d(e,t,n,o){return new Promise(function(s,a){var f;f=Array.isArray(e[t])?function(e,t){var n=e.vm,o=e.key,s=e.collection,a=e.resolve,f=e.reject,c=e.ops;void 0===t&&(t=i);var u=Object.assign({},i,t),l=u.wait?[]:c.set(n,o,[]),d=s.on("child_added",function(e,t){var n=t?r(l,t)+1:0;c.add(l,n,u.serialize(e))},f),v=s.on("child_removed",function(e){c.remove(l,r(l,e.key))},f),p=s.on("child_changed",function(e){c.set(l,r(l,e.key),u.serialize(e))},f),b=s.on("child_moved",function(e,t){var n=r(l,e.key),i=c.remove(l,n)[0],o=t?r(l,t)+1:0;c.add(l,o,i)},f);return s.once("value",function(e){u.wait&&c.set(n,o,l),a(e)}),function(e){if(s.off("child_added",d),s.off("child_changed",p),s.off("child_removed",v),s.off("child_moved",b),!1!==e){var t="function"==typeof e?e():[];c.set(n,o,t)}}}({vm:e,key:t,collection:n,resolve:s,reject:a,ops:l},o):function(e,t){var n=e.vm,r=e.key,o=e.document,s=e.resolve,a=e.reject,f=e.ops;void 0===t&&(t=i);var c=Object.assign({},i,t),u=o.on("value",function(e){f.set(n,r,c.serialize(e))},a);return o.once("value",s),function(e){if(o.off("value",u),!1!==e){var t="function"==typeof e?e():null;f.set(n,r,t)}}}({vm:e,key:t,document:n,resolve:s,reject:a,ops:l},o),e._firebaseUnbinds[t]=f})}var v={bindName:"$rtdbBind",unbindName:"$rtdbUnbind",serialize:i.serialize,reset:i.reset,wait:i.wait},p={set:function(e,n,r){return t(e,n,r)},add:function(e,t,n){return e.splice(t,0,n)},remove:function(e,t){return e.splice(t,1)}};function b(e,t,n,r,i){return new Promise(function(c,l){var d;d="where"in n?function(e,t){var n=e.vm,r=e.key,i=e.collection,f=e.ops,c=e.resolve,l=e.reject;void 0===t&&(t=s);var d,v=Object.assign({},s,t),p=v.wait?[]:f.set(n,r,[]),b=c,h=[],y={added:function(e){var t=e.newIndex,n=e.doc;h.splice(t,0,Object.create(null));var r=h[t],i=o(v.serialize(n)),s=i[0],a=i[1];f.add(p,t,s),u({refs:a,subs:r,target:p,path:t,depth:0,ops:f,resolve:c.bind(null,n)},v)},modified:function(e){var t=e.oldIndex,n=e.newIndex,r=e.doc,i=h.splice(t,1)[0];h.splice(n,0,i);var s=f.remove(p,t)[0],a=o(v.serialize(r),s),l=a[0],d=a[1];f.add(p,n,l),u({refs:d,subs:i,ops:f,target:p,path:n,depth:0,resolve:c},v)},removed:function(e){var t=e.oldIndex;f.remove(p,t),a(h.splice(t,1)[0])}},m=i.onSnapshot(function(e){var t="function"==typeof e.docChanges?e.docChanges():e.docChanges;if(!d&&t.length){d=!0;for(var i=0,o=t.length,s=Object.create(null),a=0;a<o;a++)s[t[a].doc.id]=!0;c=function(e){e.id in s&&++i>=o&&(v.wait&&f.set(n,r,p),b(n[r]),c=function(){})}}t.forEach(function(e){y[e.type](e)}),t.length||(v.wait&&f.set(n,r,p),c())},l);return function(e){if(m(),!1!==e){var t="function"==typeof e?e():[];f.set(n,r,t)}h.forEach(a)}}({vm:e,key:t,ops:r,collection:n,resolve:c,reject:l},i):function(e,t){var n=e.vm,r=e.key,i=e.document,o=e.resolve,c=e.reject,u=e.ops;void 0===t&&(t=s);var l,d,v,p=Object.assign({},s,t),b=Object.create(null);l=o,d=function(){return n[r]},v=!1,o=function(){if(!v)return v=!0,l(d())};var h=i.onSnapshot(function(e){e.exists?f({snapshot:p.serialize(e),target:n,path:r,subs:b,ops:u,depth:0,resolve:o},p):o()},c);return function(e){if(h(),!1!==e){var t="function"==typeof e?e():null;u.set(n,r,t)}a(b)}}({vm:e,key:t,ops:r,document:n,resolve:c,reject:l},i),e._firestoreUnbinds[t]=d})}var h={bindName:"$bind",unbindName:"$unbind",serialize:s.serialize,reset:s.reset,wait:s.wait};return e.firestorePlugin=function(e,t){void 0===t&&(t=h);var n=e.config.optionMergeStrategies;n.firestore=n.provide;var r=Object.assign({},h,t),i=r.bindName,o=r.unbindName;e.prototype[o]=function(e,t){this._firestoreUnbinds[e](t),delete this._firestoreUnbinds[e],delete this.$firestoreRefs[e]},e.prototype[i]=function(e,t,n){var i=Object.assign({},r,n);this._firestoreUnbinds[e]&&this[o](e,i.wait?"function"==typeof i.reset&&i.reset:i.reset);var s=b(this,e,t,p,i);return this.$firestoreRefs[e]=t,s},e.mixin({beforeCreate:function(){this._firestoreUnbinds=Object.create(null),this.$firestoreRefs=Object.create(null)},created:function(){var e=this.$options.firestore,t="function"==typeof e?e.call(this):e;if(t)for(var n in t)this[i](n,t[n],r)},beforeDestroy:function(){for(var e in this._firestoreUnbinds)this._firestoreUnbinds[e]();this._firestoreUnbinds=null,this.$firestoreRefs=null}})},e.rtdbPlugin=function(e,t){void 0===t&&(t=v);var n=e.config.optionMergeStrategies;n.firebase=n.provide;var r=Object.assign({},v,t),i=r.bindName,o=r.unbindName;e.prototype[o]=function(e,t){!function(e,t,n){e._firebaseUnbinds[t](n),delete e._firebaseSources[t],delete e._firebaseUnbinds[t]}(this,e,t)},e.prototype[i]=function(e,t,n){var i=Object.assign({},r,n);this._firebaseUnbinds[e]&&this[o](e,i.wait?"function"==typeof i.reset&&i.reset:i.reset);var s=d(this,e,t,i);return this._firebaseSources[e]=t,this.$firebaseRefs[e]=t.ref,s},e.mixin({beforeCreate:function(){this.$firebaseRefs=Object.create(null),this._firebaseSources=Object.create(null),this._firebaseUnbinds=Object.create(null)},created:function(){var e=this.$options.firebase;if("function"==typeof e&&(e=e.call(this)),e)for(var t in e)this[i](t,e[t],r)},beforeDestroy:function(){for(var e in this._firebaseUnbinds)this._firebaseUnbinds[e]();this._firebaseSources=null,this._firebaseUnbinds=null,this.$firebaseRefs=null}})},e}({});
